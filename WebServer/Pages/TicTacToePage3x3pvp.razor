@page "/tictactoe3x3pvp"

@using WebServer.Data
@using Intellectual
@using TicTacToeLib

@inject NavigationManager NavigationManager

<PageTitle>TicTacToe</PageTitle>

<div id="game-screen" class="center">
  <h2 align="center">TicTacToe Game</h2>
  @if (!Game.IsStarted)
  {
        <table class="center">
            <tr>
        <td>
            <button type="button" id="choose-value" @onclick="async () => { Player1.Value = TicTacToeValue.X; Player2.Value = TicTacToeValue.O; await Game.Init(LineSize); }">Choose X</button>
        </td>
        <td>
            <button type="button" id="choose-value"  @onclick="async () => { Player1.Value = TicTacToeValue.O; Player2.Value = TicTacToeValue.X; await Game.Init(LineSize); }">Choose O</button>
        </td>
    </tr>
    </table>
  }
  else
  {
    <table class="center">
        @for (int i = 0; i < Game.LineSize; i++)
        {
            <tr>
             @for (int j = 0; j < Game.LineSize; j++)
             {
                <td>
                  @if (Game.GetValue(i, j) == TicTacToeValue.No)
                  {
                        int row = i, col = j;
                        @if (Game.WhoseMove == Player1.Value)
                        {
                            <button type="button" class="cell" @onclick="() => Player1.MakeMove(row, col)"></button>
                        }
                        else
                        {
                            <button type="button" class="cell" @onclick="() => Player2.MakeMove(row, col)"></button>
                        }
                  }
                  else
                  {
                        <button type="button" class="cell">@Game.GetValue(i, j)</button>
                  }
                </td>
             }
            </tr>
        }
  </table>
  <button type="button" id="restart" @onclick=@ReloadPage>Restart</button> 
  }
  @if (Game.IsOvered)
    {
        <h2 align="center">Winner: @Game.Winner</h2>
    }
    
</div>

@code {
    [Inject] Game Game { get; set; }
    [Inject] Player Player1 { get; set; }
    [Inject] Player Player2 { get; set; }
    const int LineSize = 3;

    protected override void OnInitialized()
    {
        Player1.Game = Player2.Game = Game;
    }

    private void ReloadPage()
    {
        NavigationManager.NavigateTo(NavigationManager.Uri, true);
    }

}